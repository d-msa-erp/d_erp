<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>top 공통</title>
<th:block th:replace="~{/icon.html :: iconInclude}"></th:block>
<style th:fragment="topstyle">
/* top.html 내의 <style th:fragment="topstyle"> */
/* 기본 바디 스타일 */
body {
    font-family: sans-serif;
    display: flex;
    justify-content: center;
    flex-direction: column;
}

/* 전체 사이트 래퍼 */
.site-Wrapper {
    width: 100%;
    max-width: 1200px;
    padding: 20px;
    align-self: center;
    height: 80vh;
    display: grid;
    grid-template-rows: auto 1fr 1fr;
    gap: 20px;
}

/* 각 컨테이너 스타일 */
.site-Wrapper > div {
    padding: 0;
    align-items: flex-start;
    display: flex;
    flex-direction: column;
    width: 100%;
    border: 1px solid #ddd;
    border-radius: 8px;
    overflow: hidden;
}

/* 헤더 스타일 */
.site-Wrapper > div > .header {
    background: #46a6ff;
    color: white;
    padding: 10px 20px;
    font-size: 20px;
    width: 100%;
    display: flex;
    align-items: center;
    margin-bottom: 0;
    flex-shrink: 0;
}

/* 공지사항 스타일 */
.site-Wrapper .notice ul {
    padding: 15px 20px;
    list-style: none;
    overflow-y: auto;
    width: 100%;
    margin: 0;
    flex-grow: 1;
}

.site-Wrapper .notice ul li strong:hover {
    text-decoration: underline;
}

/* 입고 및 출고 테이블 스타일 */
.site-Wrapper #inv-table-wrapper,
.site-Wrapper #outbound-table-wrapper {
    padding: 15px;
    overflow-y: auto;
    width: 100%;
    flex-grow: 1;
    min-height: 150px;
    overflow-x: auto !important; /* X축 오버플로우 시 스크롤 추가 */
}

/* 테이블 스타일 */
#inv-table-wrapper table, #outbound-table-wrapper table {
    width: 100%;
    border-collapse: collapse;
}

#inv-table-wrapper th, #inv-table-wrapper td,
#outbound-table-wrapper th, #outbound-table-wrapper td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: left;
    white-space: nowrap !important;  /* 텍스트가 줄 바뀌지 않도록 설정 */
    overflow: hidden !important;    /* 넘치는 텍스트 숨김 */
    text-overflow: ellipsis !important; /* 넘칠 경우 '...' 표시 */
    max-width: 150px !important;  /* 셀의 최대 너비 설정 */
}

#inv-table-wrapper th,
#outbound-table-wrapper th {
    background-color: #f2f2f2;
}

/* 테이블 내용이 호버되었을 때 배경색 변경 */
#inv-table-wrapper tr:hover td,
#outbound-table-wrapper tr:hover td {
    background: #e6f7ff;
}




* {
	margin: 0;
	padding: 0;
	box-sizing: border-box;
}

body {
	font-family: sans-serif;
}

.top-Wrapper {
	display: flex;
	flex-direction: column;
	align-items: center;
	background-color: #f8f9fa;
    position: relative; 
    z-index: 1000; 
    width: 100%;
    /* 상단바가 항상 위에 고정되도록 하려면 아래 주석 해제 */
    /* position: sticky; */
    /* top: 0; */
    /* box-shadow: 0 2px 5px rgba(0,0,0,0.1); */
}

.top-Wrapper .top-bar {
	display: flex;
	justify-content: space-between; /* 기존 유지 */
	align-items: center;
	width: 100%;
    max-width: 1200px; 
	padding: 10px 20px;
    margin: 0 auto;
    height: 60px; /* top-bar 높이 고정 (모바일 메뉴 top 위치 기준으로 사용) */
}

.top-Wrapper .title {
	font-size: 1.5rem;
	color: #333;
	cursor: pointer;
}

.top-Wrapper .title:hover {
	color: #46a6ff;
}

/* 로그아웃 및 사용자 정보 스타일 (기존 유지) */
.top-Wrapper .logout {
	background: none;
	border: none;
	cursor: pointer;
	color: #000;
}
.top-Wrapper .logout:hover {    text-decoration: underline;}

.userName:hover {
	text-decoration: underline;
	cursor: pointer;
}
.userName-tooltip { /* 기존 스타일 유지 */
visibility: hidden;
    background-color: #333;
    color: #fff;
    text-align: center;
    border-radius: 4px;
    padding: 5px 10px;
    position: absolute;
    z-index: 1;
    top: 61%;
    right: 5%;
    transform: translateX(-50%) translateY(5px);
    white-space: nowrap;
    font-size: 0.9rem;
    opacity: 0;
    transition: opacity 0.2s;
}
.userName:hover+.userName-tooltip, .userName:focus+.userName-tooltip {
	visibility: visible; opacity: 1;
}
.top-bar .text-sm { /* 사용자 정보와 햄버거 버튼을 같이 묶기 위한 준비 */
    display: flex;
    align-items: center;
}


/* 데스크톱 네비게이션 메뉴 스타일 (기존과 유사) */
.top-Wrapper nav#main-nav { /* ID 선택자로 명확히 함 */
	display: flex; 
	justify-content: center; 
	gap: 20px;
	width: 100%;      
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px; 
    /* position: relative; /* 하위 메뉴 기준점이 되므로 menu-item에 relative 부여 */
}

.top-Wrapper .menu-item {
	position: relative; 
}

.top-Wrapper .menu-item>.label {
	padding: 10px 15px; 
	cursor: pointer;
	color: #000;
    display: block; 
    transition: background-color 0.3s, color 0.3s;
	border-radius: 3px;
}

.top-Wrapper .menu-item:hover>.label,
.top-Wrapper .menu-item.active>.label {
	background-color: #e0f0ff;
	color: #007bff;
}

.top-Wrapper .submenu {
	position: absolute; 
	top: 100%; 
	left: 0;
	background-color: #ffffff; 
	overflow: hidden;
	max-height: 0; 
	opacity: 0;    
	transition: max-height 0.3s ease-out, opacity 0.2s ease-out, transform 0.3s ease-out; 
	min-width: 160px; 
	z-index: 1001;    
	border-radius: 0 0 5px 5px; 
	pointer-events: none; 
    border: 1px solid #ddd; 
    border-top: none; 
    box-shadow: 0 4px 8px rgba(0,0,0,0.1); 
    transform: translateY(-10px); 
}

.top-Wrapper .menu-item:hover .submenu, 
.top-Wrapper .menu-item.active .submenu {
	max-height: 500px; 
	opacity: 1;
	pointer-events: auto; 
    transform: translateY(0); 
}

.top-Wrapper .submenu span {
	display: block;
	padding: 12px 15px; 
	white-space: nowrap;
	cursor: pointer;
    color: #333; 
    font-size: 0.95rem; 
}

.top-Wrapper .submenu span:hover {
	background-color: #e9ecef; 
    color: #0056b3; 
}

/* 햄버거 버튼 스타일 */
.hamburger {
    display: none;
    color: #000;
    cursor: pointer;
    background: none;
    border: none;
    padding: 0;
    margin-right: 15px;
    align-self: flex-end;
}
.hamburger span { /* material icon 크기 */
    font-size: 30px;
}
.hamburger:hover {
    color: #46a6ff;
}

/* 기본 th, td 스타일 (top.html에 있기보다는 common.css나 각 페이지 CSS에 있는 것이 좋음) */
th, td {
  white-space: nowrap !important;
  overflow: hidden !important;
  text-overflow: ellipsis !important;
  max-width: 150px !important;
  text-align: center;
}
  
/* ================= 반응형 스타일 (모바일) ================= */
@media ( max-width : 768px) {
	.top-Wrapper .title {
		font-size: 1.3rem; /* 모바일에서 타이틀 크기 약간 줄임 */
	}
	.top-Wrapper .text-sm { 
		font-size: 0.85rem;
	}
	.hamburger {
		display: block; /* 모바일에서 햄버거 버튼 표시 */
	}

	.top-Wrapper nav#main-nav {
        display: none; /* JS로 .active 클래스 추가 시 flex로 변경됨 */
        flex-direction: column; 
        width: 100%;
        text-align: left; 
        background: #fff; 
        position: absolute; /* ★★★★★ 중요: 화면 위에 떠 있도록 설정 ★★★★★ */
        top: 100px; /* .top-bar의 높이만큼 아래에 위치 */
        left: 0; 
        right: 0; /* 양쪽으로 꽉 차게 */
        box-shadow: 0 2px 5px rgba(0,0,0,0.15);
        z-index: 999; /* 다른 요소들보다 위에, 하지만 .top-Wrapper 보다는 아래일 수 있음 (top-Wrapper가 sticky일 경우) */
        padding: 0; /* 내부에서 .menu-item에 패딩 적용 */
        max-height: calc(100vh - 60px); /* 화면 높이에서 top-bar 높이만큼 제외한 최대 높이 */
        overflow-y: auto; /* 메뉴 항목 많을 경우 스크롤 */
    }
    .top-Wrapper nav#main-nav.active { /* JS에서 .active 클래스 추가 시 */
        display: flex;
    }

	.top-Wrapper .menu-item {
        width: 100%; 
    }
    .top-Wrapper .menu-item > .label {
        padding: 15px 20px; /* 모바일용 패딩 증가 */
        border-bottom: 1px solid #eee; 
    }
    .top-Wrapper .menu-item:last-child > .label {
        border-bottom: none; 
    }

	.top-Wrapper .menu-item .submenu { 
		position: static; /* 모바일에서는 absolute 해제, 일반 block처럼 동작 */
		max-height: 0;
		opacity: 0;
        width: 100%;
        box-shadow: none;
        border: none;
        border-radius: 0;
        background-color: #f8f9fa; 
        transform: none; 
        padding-left: 20px; 
        transition: max-height 0.3s ease-out, opacity 0.2s ease-out; /* transform 제거 */
        overflow: hidden; /* JS로 max-height 제어 시 필요 */
	}
	.top-Wrapper .menu-item.active .submenu { 
        display: block; /* JS에서 .active 토글 시 하위 메뉴 보이도록 */
        max-height: 500px; 
        opacity: 1;
	}
    .top-Wrapper .menu-item .submenu span {
        padding: 12px 20px; /* 하위 메뉴 패딩 */
        border-bottom: 1px solid #eee;
    }
    .top-Wrapper .menu-item .submenu span:last-child {
        border-bottom: none;
    }
}
</style>
</head>
<body>
	<header th:fragment="top">
		<div class="top-Wrapper">
			<div class="top-bar">
				<div class="title" onclick="location.href='/'" id="site-title">스마트 제조 시스템</div>
				<div class="text-sm"> <th:block th:if="${session.loggedInUser != null}">
						<span class="material-symbols-outlined" style="vertical-align: middle;">person</span>
						<span onclick="location.href='/mypage'" class="userName"
							th:text="${session.loggedInUser.userNm}"></span> 님
						<div class="userName-tooltip">마이페이지로 이동</div>
						<span>&nbsp;|&nbsp;</span> <button class="logout" onclick="location.href='/logout'">로그아웃</button>
					</th:block>
					<th:block th:if="${session.loggedInUser == null}">
						<button class="login" onclick="location.href='/login'">로그인</button>
					</th:block>
				</div>
			</div>
                    <button type="button" class="hamburger" id="hamburger-btn">
                        <span class="material-symbols-outlined"> menu </span>
                    </button>
			<nav id="main-nav"
				th:if="${session.loggedInUser != null and session.loggedInUser.userStatus == '01'}">
				<div class="menu-item" onclick="toggleMenu(event, this)"
					th:if="${{'01','02', '03', '04', '05', '06'}.contains(session.loggedInUser.userRole)}">
					<div class="label">기준 정보 관리</div>
					<div class="submenu">
						<span onclick="location.href='/site'" th:if="${{'01','02'}.contains(session.loggedInUser.userRole)}">사업장 관리</span> 
                        <span onclick="location.href='/customer'" th:if="${{'01','02', '03', '04'}.contains(session.loggedInUser.userRole)}">거래처 관리</span> 
                        <span onclick="location.href='/inventory'" th:if="${{'01','02', '04', '05', '06'}.contains(session.loggedInUser.userRole)}">품목 관리</span> 
                        <span onclick="location.href='/bom'" th:if="${{'01','02', '05'}.contains(session.loggedInUser.userRole)}">BOM 관리</span> 
                        <span onclick="location.href='/warehouse'" th:if="${{'01','02', '06'}.contains(session.loggedInUser.userRole)}">창고 관리</span>
					</div>
				</div>
				<div class="menu-item" onclick="toggleMenu(event, this)"
					th:if="${{'01','02', '03', '04', '05', '06'}.contains(session.loggedInUser.userRole)}">
					<div class="label">구매 / 영업 관리</div>
					<div class="submenu">
						<span onclick="location.href='/purchase'" th:if="${{'01', '02','04'}.contains(session.loggedInUser.userRole)}">발주 관리</span> 
                        <span onclick="location.href='/sales'" th:if="${{'01','02', '03'}.contains(session.loggedInUser.userRole)}">주문 관리</span> 
                        <span onclick="location.href='/outbound'" th:if="${{'01','02', '03', '06'}.contains(session.loggedInUser.userRole)}">출고 관리</span> 
                        <span onclick="location.href='/mrp'" th:if="${{'01', '02','04', '05'}.contains(session.loggedInUser.userRole)}">자재 소요량 계산(MRP)</span>
					</div>
				</div>
				<div class="menu-item" onclick="toggleMenu(event, this)"
					th:if="${{'01','02', '04', '06'}.contains(session.loggedInUser.userRole)}">
					<div class="label">자재 관리</div>
					<div class="submenu">
						<span onclick="location.href='/inbound'" th:if="${{'01','02', '04', '06'}.contains(session.loggedInUser.userRole)}">입고 관리</span> 
                        <span onclick="location.href='/stock'" th:if="${{'01','02', '06'}.contains(session.loggedInUser.userRole)}">재고 관리</span>
					</div>
				</div>
				<div class="menu-item" onclick="toggleMenu(event, this)"
					th:if="${{'01','02', '05'}.contains(session.loggedInUser.userRole)}">
					<div class="label">생산 관리</div>
					<div class="submenu">
						<span onclick="location.href='/planning'" th:if="${{'01','02', '05'}.contains(session.loggedInUser.userRole)}">생산 계획</span>
					</div>
				</div>
				<div class="menu-item" onclick="toggleMenu(event, this)"
					th:if="${{'01','02', '07'}.contains(session.loggedInUser.userRole)}">
					<div class="label">인사 관리</div>
					<div class="submenu">
						<span onclick="location.href='/hr'" th:if="${{'01','02', '07'}.contains(session.loggedInUser.userRole)}">사원 관리</span>
					</div>
				</div>
			</nav>
		</div>
	</header>
</body>
</html>