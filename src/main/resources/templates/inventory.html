<!DOCTYPE html>
<html lang="ko">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>품목 관리</title>
	<th:block th:replace="~{/icon.html :: iconInclude}"></th:block>
	<style th:replace="~{/top.html :: topstyle}"></style>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: sans-serif;
			display: flex;
			flex-direction: column;
			justify-content: center;
		}

		.site-Wrapper {
			width: 100%;
			max-width: 1200px;
			align-self: center;
			padding: 20px;
		}

		.site-Dataset {
			width: 100%;
			border: 1px solid #777;
			border-radius: 10px;
			overflow: hidden;
			display: flex;
			flex-direction: column;
		}

		.site-Dataset .header {
			background: #46a6ff;
			color: white;
			padding: 10px 20px;
			font-size: 20px;
		}

		.site-Dataset .form-content {
			display: flex;
			flex-wrap: wrap;
			padding: 20px;
			gap: 20px;
		}

		.form-item {
			display: flex;
			align-items: center;
			width: calc(33.333% - 13.33px);
		}

		.form-item.addr {
			width: calc(66.666% - 10px);
		}

		.form-item span {
			padding-right: 10px;
			white-space: nowrap;
		}

		.form-item input {
			width: 100%;
			height: 100%;
			border-radius: 3px;
			padding: 5px;
			font-size: 14px;
			border: 1px solid #ccc;
		}

		.form-item input:focus {
			border: 1px solid #46a6ff;
			outline: none;
		}

		.table-wrapper {
			width: 100%;
			max-width: 1200px;
		}

		.table-wrapper>div:nth-child(1) {
			padding: 20px 20px 0 20px;
			display: flex;
			justify-content: flex-end;
			gap: 20px;
			position: relative;
		}

		.table-wrapper>div:nth-child(1)>input[type="text"] {
			width: 30%;
			padding: 5px;
		}

		.table-wrapper>div:nth-child(1)>div {
			width: 30%;
			display: flex;
			justify-content: space-between;
		}

		.table-wrapper>div:nth-child(1)>.btn-wrap1 {
			background: #fff;
			border: none;
			border-radius: 5px;
			position: absolute;
			left: 20px;
			display: flex;
			justify-content: flex-start;
			gap: 10px;
		}

		.table-wrapper>div:nth-child(1)>div button {
			width: 30%;
			background: #fff;
			border: none;
			border-radius: 5px;
			cursor: pointer;
			white-space: nowrap;
		}

		.table-wrapper>div:nth-child(1)>.btn-wrap1 button {
			padding: 5px;
			gap: 10px;
			background: #fff;
			border: none;
			border-radius: 5px;
			cursor: pointer;
			white-space: nowrap;
		}

		.table-wrapper>div:nth-child(1)>div button:nth-child(1) {
			background: #007bff;
			color: white;
		}

		.table-wrapper>div:nth-child(1)>div button:nth-child(2) {
			background: #28a745;
			color: white;
		}

		.table-wrapper>div:nth-child(1)>div button:nth-child(3) {
			background: #dc3545;
			color: white;
		}

		.table-wrapper>div:nth-child(2) {
			padding: 20px 20px 0 20px;
			display: flex;
			flex-direction: column;
		}

		.table-wrapper>div:nth-child(2)>span {
			width: 30%;
			padding-right: 10px;
			text-align: center;
			cursor: pointer;
		}

		.table-wrapper>div:nth-child(2)>span.active {
			font-weight: bold;
			text-decoration: underline;
		}

		.table-wrapper>div:nth-child(3) {
			position: relative;
		}

		.nodata {
			grid-column:span 9;
		}
		.nodata p{
			text-align: center;
			width: 100%;
		}

		.print-wrap {
			position: absolute;
			top: 0;
			right: 0;
			padding: 0 20px;
			display: flex;
			gap: 10px;
			width: 200px;
		}

		.print-wrap>button {
			width: 100%;
			background: #007bff;
			color: #fff;
			border: none;
			border-radius: 5px;
			cursor: pointer;
			padding: 5px;
		}

		table.grid-table {
			margin-top:25px;
			width: 100%;
			border-collapse: collapse;
			display: grid;
			grid-template-columns: 1fr 2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr;
		}

		thead,
		tbody,
		tr {
			display: contents;
		}

		tbody>tr:nth-child(even) td {
			background: #f9f9f9;
		}

		tbody>tr:hover td {
			background: #46a6ff;
			cursor: pointer;
		}

		tr th:nth-child(1),
		tr td:nth-child(1),
		tr th:nth-last-child(1) {
			justify-content: center;
		}

		tr td:nth-last-child(1) {
			justify-content: right;
		}

		th,
		td {
			padding: 10px;
			border: 1px solid #ccc;
			display: flex;
			align-items: center;
		}

		thead th {
			background: #f0f0f0;
			font-weight: bold;
			cursor: pointer;
		}

		table input[type="text"] {
			width: 100%;
			padding: 5px;
		}

		.pagination-wrap {
			display: flex;
			flex-direction: column;
			align-items: flex-end;
			padding-top: 20px;
		}

		.pagination-wrap>div {
			display: flex;
			align-items: center;
			gap: 10px;
		}

		.pagination-wrap>div input[type="text"] {
			width: 50px;
			text-align: center;
		}

		.pagination-wrap>div button {
			width: 20px;
			background: #007bff;
			color: white;
			border: none;
			border-radius: 5px;
			cursor: pointer;
		}

		.table-wrapper button:hover {
			filter: brightness(0.9);
		}

		.modal {
			display: none;
			position: fixed;
			top: 0;
			left: 0;
			width: 100vw;
			height: 100vh;
			background: rgba(0, 0, 0, 0.4);
			justify-content: center;
			align-items: center;


			backdrop-filter: blur(4px);
			-webkit-backdrop-filter: blur(4px);
		}

		.modal-content {
			background: white;
			padding: 20px;
			border-radius: 10px;
			width: 80%;
			position: relative;
		}

		.modal-content .modalForm {
			margin-top: 20px;
			display: grid;
			gap: 20px;
			justify-items: center;
			align-items: center;
		}

		.modal-content .modalForm>div,
		.modal-content .modalForm>label {
			width: 100%;
			display: flex;
			justify-content: space-between;
			align-items: center;
		}

		.modal-content .modalForm>div>span,
		.modal-content .modalForm>label>span {
			white-space: nowrap;
			padding-right: 10px;
		}

		.modal-content input[type="text"] {
			width: 100%;
			padding: 10px;
			border: 1px solid #ccc;
		}

		.modal-content input[type="color"] {
			width: 100%;
			height: 40px;
			border: none;
			margin-top: 10px;
		}

		.modal-content .modal-buttons {
			display: flex;
			justify-content: flex-end;
			gap: 10px;
			width: 100%;
			grid-column-start: 3;
		}

		.modal-content .modal-buttons>button:hover {
			filter: brightness(0.9);
		}

		.modal-content .modal-buttons>button {
			width: 100%;
			background: #007bff;
			color: #fff;
			border: none;
			border-radius: 5px;
			cursor: pointer;
			padding: 5px;
		}

		.modal-buttons button:nth-of-type(3) {
			background: #777 !important;
		}
	</style>

</head>

<body>
	<div th:replace="~{/top.html :: top}"></div>
	<div class="site-Wrapper">
		<h1 style="font-size: 24px; margin-bottom: 16px;">품목 관리</h1>
		<form id="frm" method="get" action="#">
			<div class="site-Dataset">
				<div class="header">
					<h4 style="margin: 0;">품목 관리</h4>
				</div>
				<div class="table-wrapper">
					<div>
						<div>
							<select style="width: 100%;">
								<option value="대분류">대분류</option>
								<option value="소분류">소분류</option>
								<option value="제품">제품</option>

							</select>
						</div>

						<input type="text" placeholder="검색" />
						<div>
							<button type="button">
								<span class="material-symbols-outlined">search</span> 검색
							</button>
							<button type="button" onclick="openModal()">
								<span class="material-symbols-outlined">add</span> 신규등록
							</button>
							<button type="button">
								<span class="material-symbols-outlined">delete</span> 삭제
							</button>
						</div>
					</div>
					<div></div>
					<div id="table-customer" style="padding: 20px; position: relative;">
						<div class="print-wrap">
							<button type="button">
								<span class="material-symbols-outlined">table_view</span> 엑셀
							</button>
							<button type="button">
								<span class="material-symbols-outlined">print</span> 인쇄
							</button>
						</div>
						<!-- <p class="nodata">등록된 품목이 없습니다.</p> -->
						<!--데이터 없을 땐 이렇게 표기-->
						<table class="grid-table">

							<thead>

								<tr>
									<th><input type="checkbox" /></th>
									<th onclick="order(this)">품목명<a>↓</a></th>
									<th onclick="order(this)">품목코드<a>↓</a></th>
									<th onclick="order(this)">대분류<a>↓</a></th>
									<th onclick="order(this)">소분류<a>↓</a></th>
									<th onclick="order(this)">거래처<a>↓</a></th>
									<th onclick="order(this)">단위<a>↓</a></th>
									<th onclick="order(this)">현재고량<a>↓</a></th>
									<th onclick="order(this)">단가<a>↓</a></th>
								</tr>
							</thead>
							<tbody id="itembody">
								<tr id="Noitem" style="display: none;">
									<td class="nodata" colspan="9"><p>등록된 품목이 없습니다.</p></td>
								</tr>
							
							    <!-- <tr th:if="${#lists.isEmpty(items)}">
                					<td class="nodata"><p>등록된 품목이 없습니다.</p></td>
            					</tr>
								몇개씩 자를지는 상의해봐요 ~
								<tr onclick="opendatail()" th:each="item : ${items}">
									<td onclick="event.stopPropagation()">
									<input type="checkbox" /></td>
									<td th:text="${item.ITEM_NM}"></td>
									<td th:text="${item.ITEM_CD}"></td>
									<td th:text="${item.ITEM_CAT1}"></td>
									<td th:text="${item.ITEM_CAT2}"></td>
									<td th:text="${item.CUST_IDX}"></td>
									<td th:text="${item.UNIT_NM}"></td>
									<td th:text="${item.QTY}"></td>
									<td th:text="${item.ITEM_COST}"></td>
								</tr> -->
							</tbody>
						</table>
<script>
        document.addEventListener('DOMContentLoaded', function() {
            const itemTableBody = document.getElementById('itembody');
            const noDataRow = document.getElementById('Noitem');
            const prevPageButton = document.getElementById('btn-prev-page');
            const nextPageButton = document.getElementById('btn-next-page');
            const currentPageInput = document.getElementById('currentPageInput');
            const totalCountSpan = document.querySelector('.pagination-wrap span:first-child');
            const currentPageSpan = document.querySelector('.pagination-wrap span:nth-child(2)');

            let currentPage = 1;
            let totalPages = 1;
            const pageSize = 10;

            function fetchItems(page) {
                fetch(`/api/items?page=${page}&size=${pageSize}`)
                    .then(response => { // 첫 번째 .then()에서 response 객체 받음
                        const totalCount = response.headers.get('X-Total-Count'); // 헤더 추출
                        return response.json().then(data => ({ data: data, totalCount: totalCount })); // 데이터와 총 개수 함께 반환
                    })
                    .then(({ data, totalCount }) => { // 두 번째 .then()에서 받음
                        console.log('서버 응답 데이터:', data);
                        console.log('총 개수:', totalCount);

                        const items = data; // 서버가 배열 형태로 데이터를 반환한다고 가정
                        totalPages = Math.ceil(totalCount / pageSize);
                        currentPage = page;

                        totalCountSpan.textContent = `총 ${totalCount || 0}건`;
                        currentPageSpan.textContent = `${currentPage}/${totalPages || 1}페이지`;
                        prevPageButton.disabled = currentPage === 1;
                        nextPageButton.disabled = currentPage === totalPages;
                        currentPageInput.value = currentPage;

                        itemTableBody.innerHTML = '';
                        if (items && items.length > 0) {
                            noDataRow.style.display = 'none';
                            items.forEach(item => {
                                const row = itemTableBody.insertRow();
                                const checkboxCell = row.insertCell();
                                const checkbox = document.createElement('input');
                                checkbox.type = 'checkbox';
                                checkboxCell.appendChild(checkbox);
                                const itemNameCell = row.insertCell();
                                itemNameCell.textContent = item.item_NM || "";
                                const itemCodeCell = row.insertCell();
                                itemCodeCell.textContent = item.item_CD || "";
                                const itemCat1Cell = row.insertCell();
                                itemCat1Cell.textContent = item.item_CAT1 || "";
                                const itemCat2Cell = row.insertCell();
                                itemCat2Cell.textContent = item.item_CAT2 || "";
                                const custIdxCell = row.insertCell();
                                custIdxCell.textContent = item.CUST_IDX || ""; 
                                const unitNmCell = row.insertCell();
                                unitNmCell.textContent = item.UNIT_NM || "";   
                                const qtyCell = row.insertCell();
                                qtyCell.textContent = item.QTY || "";         
                                const itemCostCell = row.insertCell();
                                itemCostCell.textContent = item.item_COST || "";
                            });
                        } else {
                            noDataRow.style.display = '';
                        }
                    })
                    .catch(error => {
                        console.error('데이터를 가져오는 중 오류 발생:', error);
                        noDataRow.style.display = '';
                    });
            }

            // 초기 데이터 로딩 (1페이지)
            fetchItems(currentPage);

            prevPageButton.addEventListener('click', function() {
                if (currentPage > 1) {
                    fetchItems(currentPage - 1);
                }
            });

            nextPageButton.addEventListener('click', function() {
                if (currentPage < totalPages) {
                    fetchItems(currentPage + 1);
                }
            });

            currentPageInput.addEventListener('change', function() {
                const pageNumber = parseInt(this.value);
                if (!isNaN(pageNumber) && pageNumber >= 1 && pageNumber <= totalPages) {
                    fetchItems(pageNumber);
                } else {
                    alert('유효한 페이지 번호를 입력하세요.');
                    this.value = currentPage;
                }
            });
        });
    </script>				
						
						
<!-- 						<div class="pagination-wrap">
							총 n건 1/n페이지
							<div class="paigination">
								<button type="button" id="btn-prev-page">
									<span class="material-symbols-outlined">chevron_left</span>
								</button>
								<input type="text" value="1">
								<button type="button" id="btn-next-page">
									<span class="material-symbols-outlined">chevron_right</span>
								</button>
							</div>
						</div> -->
						 <div class="pagination-wrap">
					        <span th:text="|총 ${totalCount}건|">총 n건</span>
					        <span th:text="|${currentPage}/${totalPages}페이지|">1/n페이지</span>
					        <div class="paigination">
					            <button type="button" id="btn-prev-page" th:disabled="${currentPage == 1}">
					                <span class="material-symbols-outlined">chevron_left</span>
					            </button>
					            <input type="text" th:value="${currentPage}" id="currentPageInput">
					            <button type="button" id="btn-next-page" th:disabled="${currentPage == totalPages}">
					                <span class="material-symbols-outlined">chevron_right</span>
					            </button>
					        </div>
					    </div>
					</div>


				</div>
			</div>
		</form>
	</div>

	<!--신규 등록 Modal-->
	<div class="modal" id="modal" onclick="outsideClick(event)">
		<div class="modal-content" onclick="event.stopPropagation()">
			<h3 id="modalTitle">신규 등록</h3>
			<form id="modalForm" class="modalForm">
				<div>
					<span>품목코드</span><input type="text" placeholder="품목코드를 입력해주세요" required />
				</div>
				<div>
					<span>품목명</span><input type="text" placeholder="품목명을 입력해주세요" required />
				</div>
				<div>
					<span>거래처</span><input type="text" placeholder="거래처를 입력해주세요" required />
				</div>
				<div>
					<span>대분류</span><input type="text" placeholder="대분류를 입력해주세요" required />
				</div>

				<div>
					<span>소분류</span><input type="text" placeholder="소분류를 입력해주세요" required />
				</div>
				<div>

					<span>규격</span><input type="text" placeholder="규격을 입력해주세요" required />
				</div>
				<div>
					<span>단가</span><input type="text" placeholder="단가를 입력해주세요" required />
				</div>
				<div>
					<span>비고</span><input type="text" placeholder="비고를 입력해주세요" required />
				</div>
				<div style="display: grid; grid-template-columns: 1fr 1fr 1fr;">

					<div class="modal-buttons">
					<button type="button" name="save" style="display: none;">
						<span class="material-symbols-outlined">save</span> 등록
					</button>
					<button type="button" name="edit" style="display: block;">
						<span class="material-symbols-outlined">edit</span> 수정
					</button>
					<button type="button" onclick="closeModal('modal')">
						<span class="material-symbols-outlined">close</span> 취소
					</button>
				</div>
				</div>
			</form>
		</div>

	</div>

	<script src="/js/top.js"></script>
	<script>
		let currentTh = null;
		let currentOrder = 'desc';

		function order(thValue) {//정렬
			const allArrows = document.querySelectorAll("th a");
			allArrows.forEach(a => a.textContent = '↓');

			if (currentTh === thValue) {
				currentOrder = currentOrder === 'desc' ? 'asc' : 'desc';
			} else {
				currentOrder = 'asc';
				currentTh = thValue;
			}

			const arrow = thValue.querySelector('a');
			arrow.textContent = currentOrder === 'asc' ? '↑' : '↓';
		}





		//Modal ~ 
		function openModal() {
			const title = document.getElementById('modalTitle');
			title.textContent = '신규 품목 등록';
			document.getElementById('modal').style.display = 'flex';
			document.querySelector('#modalForm button[name="save"]').style.display = 'block';
			document.querySelector('#modalForm button[name="edit"]').style.display = 'none';
		}

		function closeModal() {
			document.getElementById('modal').style.display = 'none';
		}

		function outsideClick(e) {
			if (e.target.id === 'modal') {
				closeModal();
			}
		}



		function submitModal(event) {
			event.preventDefault();
			const siteName = document.querySelector('#modalForm input[name="siteName"]').value;
			console.log(currentTab + ' 등록됨:', siteName);
			closeModal();
		}

		//테이블 클릭 시 출력되는 modal
		function opendatail() {
			openModal();
			document.getElementById('modalTitle').textContent = '품목 수정';

			document.querySelector('#modalForm button[name="save"]').style.display = 'none';
			document.querySelector('#modalForm button[name="edit"]').style.display = 'block';
		}
	</script>

</body>

</html>